<?xml version='1.0' encoding='utf-8'?>

<form>
	<label>Database</label>

	<row>
		<html>
			<h1>Database Profiling</h1>
			<p>
			Django will log SQL database queries executed if the django.db logger is set to debug level.
			Configure Django to output the query logs to use this dashboard.
			</p>
			<p>
				For more information, consult
				<a href="http://lukemurphey.net/projects/django-splunk/wiki/Configuring_splunk_for_django">LukeMurphey.net</a>.
			</p>
		</html>
	</row>

	<fieldset autoRun="true">
		<input type="time">
			<default>Last 24 hours</default>
		</input>
		<input type="dropdown" token="source">
			<label>Source:</label>
			<default>*</default>
			<choice value="*">All</choice>
			<populatingSearch fieldForLabel="source" fieldForValue="source">
				sourcetype="django" source="$source$" | stats count by source
			</populatingSearch>
		</input>
	</fieldset>

	<row>
		<chart>
			<!-- <searchName>database_query_counts</searchName> -->
			<searchString>sourcetype=django source="$source$" tag=database_query | timechart sum(duration)</searchString>
			<title>Query Duration (over time)</title>
			<option name="charting.chart">area</option>
			<option name="count">10</option>
			<option name="displayRowNumbers">true</option>
			<option name="charting.chart.nullValueMode">zero</option>
		</chart>
		<table>
			<!-- <searchName>sql_query_actions</searchName> -->
			<searchString>sourcetype="django" source="$source$" (SELECT OR UPDATE OR DELETE OR INSERT) | stats sparkline count sum(duration), avg(duration), max(duration) by sql_action</searchString>
			<title>Queries</title>
			<option name="count">10</option>
			<option name="displayRowNumbers">true</option>
		</table>
	</row>
	<row>
		<table>
			<!-- <searchName>most_common_sql_queries_summary</searchName> -->
			<searchString>sourcetype="django" source="$source$" tag=database_query sql_action=SELECT | fillnull value="" join_type join_table | stats sparkline count(table) as count, sum(duration), avg(duration), max(duration) by table, join_type, join_table | sort -count</searchString>
			<title>Most Common Queries</title>
		</table>
	</row>
</form>